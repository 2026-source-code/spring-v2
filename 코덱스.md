# 코덱스 (boardv1)

## 1) 프로젝트 개요
- Spring Boot 기반의 간단한 게시판 애플리케이션입니다.
- 사용자 회원가입/로그인(세션 기반), 게시글 CRUD, 댓글 CRUD, Mustache 템플릿 렌더링을 제공합니다.
- 인메모리 H2 DB와 `data.sql` 초기 데이터로 구동됩니다.

## 2) 기술 스택
- Java 21 (`build.gradle` Toolchain)
- Spring Boot 4.0.2
- Spring MVC (`spring-boot-starter-webmvc`)
- Spring Data JPA (`spring-boot-starter-data-jpa`)
- Mustache (`spring-boot-starter-mustache`)
- H2 (`h2` + `spring-boot-h2console`)
- Lombok

## 3) 주요 디렉터리 구조
- `src/main/java/com/example/boardv1`
- `board`: 게시글 도메인(엔티티/컨트롤러/서비스/리포지토리/DTO)
- `reply`: 댓글 도메인(엔티티/컨트롤러/서비스/리포지토리/DTO)
- `user`: 사용자 도메인(엔티티/컨트롤러/서비스/리포지토리/DTO)
- `_core/errors`: 글로벌 예외 핸들링
- `src/main/resources/templates`: Mustache 뷰 템플릿
- `src/main/resources/db/data.sql`: 초기 데이터
- `src/test/java`: 리포지토리 테스트

## 4) 도메인 모델
- `User`
- 필드: `id`, `username`(unique), `password`, `email`, `createdAt`
- 관계: 1(사용자) : N(게시글), 1(사용자) : N(댓글)

- `Board`
- 필드: `id`, `title`, `content`, `createdAt`
- 관계: N(게시글) : 1(사용자) `@ManyToOne(fetch = EAGER)`
- 관계: 1(게시글) : N(댓글) `@OneToMany(mappedBy = "board", fetch = EAGER)`

- `Reply`
- 필드: `id`, `comment`, `createdAt`
- 관계: N(댓글) : 1(게시글), N(댓글) : 1(사용자)

## 5) 주요 기능 흐름
- 회원가입: `UserService`에서 username 중복 체크 후 저장
- 로그인: username 조회 후 password 비교 → 세션에 `sessionUser` 저장
- 게시글 CRUD: 로그인 체크 + 소유자 권한 체크
- 댓글 CRUD: 로그인 체크 + 소유자 권한 체크

## 6) 라우팅 (Controller)
- 홈/게시글
- `GET /` 게시글 목록
- `GET /boards/{id}` 게시글 상세
- `GET /boards/save-form` 글쓰기 폼
- `POST /boards/save` 글쓰기
- `GET /boards/{id}/update-form` 글수정 폼
- `POST /boards/{id}/update` 글수정
- `POST /boards/{id}/delete` 글삭제
- `GET /api/boards/{id}` 상세 JSON 응답

- 사용자
- `GET /join-form`, `POST /join`
- `GET /login-form`, `POST /login`
- `GET /logout`

- 댓글
- `POST /replies/save`
- `POST /replies/{id}/delete?boardId=...`

## 7) 뷰 템플릿 (Mustache)
- `templates/header.mustache`: 공통 헤더(세션 유무에 따라 메뉴 분기)
- `templates/index.mustache`: 게시글 목록
- `templates/board/*.mustache`: 게시글 상세/작성/수정
- `templates/user/*.mustache`: 회원가입/로그인

## 8) 데이터베이스/초기 데이터
- `application.properties`에서 H2 인메모리 `jdbc:h2:mem:test` 사용
- `spring.sql.init.data-locations=classpath:db/data.sql`로 초기 데이터 주입
- `data.sql`에 사용자, 게시글, 댓글 샘플 포함

## 9) 예외 처리
- `@RestControllerAdvice` 기반 `GlobalExceptionHandler`
- `Exception400/401/403/404/500` 처리
- 브라우저 `alert` + `history.back()` 또는 `location.href` 방식으로 사용자 피드백

## 10) 테스트
- `UserRepositoryTest`, `BoardRepositoryTest`
- `@DataJpaTest` + `@Import(Repository)` 방식의 리포지토리 단위 테스트

## 11) 구성/환경 참고
- 서버 포트: `8080`
- 세션: 쿠키 기반, `server.servlet.session.timeout=1m`
- `spring.jpa.open-in-view=false`

## 12) 주의 사항
- 소스/템플릿에 한글 인코딩이 깨져 보이는 부분이 있습니다(README, Mustache, 주석 등). 필요 시 파일 인코딩(UTF-8) 점검 권장.
- 일부 템플릿에 HTML 태그가 깨져 있을 수 있습니다(예: `</a>` 누락). 화면 동작 확인 필요.
